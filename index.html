<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">

  <title>Number guessing game</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css">

  <style>
    html {
      font-family: sans-serif;
    }

    body {
      width: 50%;
      max-width: 800px;
      min-width: 480px;
      margin: 0 auto;
    }
    
    .dinoMite {
      background-image: url("https://publicdomainpictures.net/pictures/10000/velka/dinosaur-background-20851282041923qTUN.jpg"); /* The image used */
/*       background-image: url("dinosaur-background-20851282041923qTUN.jpg"); /* The image used */ */
      margin-top: -40px;
      height: 480px; /* You must set a specified height */
      background-position: center; /* Center the image */
      background-repeat: no-repeat; /* Do not repeat the image */
      background-size: cover; /* Resize the background image to cover the entire container */
    }

    .instructions {
      margin-right: 50%;
      margin-top: -20px;
      margin-bottom: 10px;
    }

    .lastResult {
      color: white;
      padding: 3px;
    }

    .hidden {
      display: none;
    }
  </style>
</head>

<body class="dinoMite">
<section class="section">
  <div class="container">
    <h1 class="title">Number guessing game</h1>

    <p class="instructions"></p>

    <div class="field has-addons" id="submitter">
      <div class="control">
        <input type="text" id="guessField" class="guessField input" placeholder="Enter a number">
      </div>
      <div class="control">
        <input class="guessSubmit button is-info" type="submit" value="Submit guess">
      </div>
	  <button class="resetButton is-hidden button is-info">Start new game</button>
    </div>
    
    <div class="field">
    </div>

    <progress class="progress is-large is-hidden is-success" value="0" max=""></progress>

    <div class="field resultParas">
      <p class="guesses"></p>
      <p class="lastResult"></p>
      <p class="lowOrHi is-hidden"></p>
    </div>

    <article class="message is-danger is-hidden">
      <div class="message-header">
        <p></p>
      </div>
      <div class="message-body">

      </div>
    </article>
  </div>
</section>


<script>

  class ProgressBar {
    constructor(element) {
      this.bar = element;
    }
    
    set max(value) {
      this.bar.max = value;
    }
    
    increment() {
      if (this.bar.classList.contains('is-hidden')) {
        this.bar.classList.remove('is-hidden');
      }
      this.bar.value = this.bar.value + 1;

      const guessesLeft = this.bar.max - this.bar.value;
      if (guessesLeft < 3 && guessesLeft > 1) {
        this.warning();
      } else if (guessesLeft === 1) {
        this.danger();
      }
    }
    
    reset() {
      this.bar.value = 0;
      this.bar.classList.remove('is-warning', 'is-danger');
      this.bar.classList.add('is-success', 'is-hidden');
    }
    
    warning() {
      this.bar.classList.remove('is-success', 'is-danger');
      this.bar.classList.add('is-warning');
    }
    
    danger() {
      this.bar.classList.remove('is-success', 'is-warning');
      this.bar.classList.add('is-danger');
    }
  }
    

  class Board {
    constructor(parentElement) {
      this.instructions = parentElement.querySelector('.instructions');
      this.guesses = parentElement.querySelector('.guesses');
      this.lastResult = parentElement.querySelector('.lastResult');
      this.lowOrHi = parentElement.querySelector('.lowOrHi');
      this.progressBar = new ProgressBar(parentElement.querySelector('progress'));

      this.guessSubmit = parentElement.querySelector('.guessSubmit');
      this.guessField = parentElement.querySelector('.guessField');
      this.guessField.focus();

      this.message = parentElement.querySelector('.message');
      this.messageTitle = parentElement.querySelector('.message-header p');
      this.messageBody = parentElement.querySelector('.message-body');

      this.resetButton = parentElement.querySelector('.resetButton');
    }
    
    setup(options) {
      this.progressBar.max = options['guesses'];
      this.instructions.textContent = `We have selected a random number between 1 and ${options['max_value']}. Guess it in ${options['guesses']} turns or fewer to escape the T-Rex.`
    }

    get userGuess() {
      return Number(this.guessField.value);
    }
    resetUserGuessField() {
      this.guessField.value = '';
      this.guessField.focus();
    }

    displayGuess(guess) {
      if (this.guesses.textContent === '') {
        this.guesses.textContent = 'Guesses: ';
      }
      this.guesses.textContent += guess + ' ';
      this.progressBar.increment();
    }

    tooHigh(guessesLeft) {
      this._sayWrong(guessesLeft, 'too high');
    }
    tooLow(guessesLeft) {
      this._sayWrong(guessesLeft, 'too low');
    }
    justRight() {
	  this._sayMessage('Correct!', 'Congratulations! You got it right! No dinner for T-Rex.')
      this.message.classList.replace('is-danger', 'is-success');
      this.lowOrHi.textContent = '';
      this._endGame();
    }
    tooManyGuesses(number) {
      this._sayMessage('Game Over!', 'You are out of guesses. The number was ' + number + '. Dinner time for T-Rex!')
      this._endGame();
	  new Audio('http://soundbible.com/grab.php?id=1748&type=mp3').play();
    }

    reset(){
      this.guesses.textContent = '';
      this.lastResult.textContent = '';
      this.lowOrHi.textContent = '';
      this.progressBar.reset();
      this.resetButton.classList.add('is-hidden');
      this.message.classList.add('is-hidden');

      this.guessField.classList.remove('is-hidden');
      this.guessSubmit.classList.remove('is-hidden');
      this.resetUserGuessField();
    }

    _sayWrong(guessesLeft, message) {
	  this._sayMessage('Wrong!', 'Your guess is ' + message + '. You have ' + guessesLeft + ' guesses left.')
    }
    
    _sayMessage(title, body) {
      this.messageTitle.textContent = title;
      this.messageBody.textContent = body;
      this.message.classList.remove('is-hidden');
    }

    _endGame(){
      this.guessField.classList.add('is-hidden');
      this.guessSubmit.classList.add('is-hidden');
      this.resetButton.classList.remove('is-hidden');
      this.resetButton.focus();
    }
  }
  
  class Game {
    constructor(board, options) {
	  options = Object.assign({ max_value: 100, guesses: 10 }, options)

      this.board = board;
      this.board.guessSubmit.addEventListener('click', this.checkGuess.bind(this), false);
      this.board.guessField.addEventListener('keypress', function(e) {
        if(e.key == 'Enter') {
          this.checkGuess();
        }
      }.bind(this))
      this.board.resetButton.addEventListener('click', this.reset.bind(this), false);

      this.board.setup(options);
      this.numberOfGuesses = options['guesses'];
      this.maxValue = options['max_value'];
      this.start();
    }
    
    start(){
      this.number = Math.floor(Math.random() * this.maxValue) + 1;
      this.guessCount = 1;
    }
    
    checkGuess(){
      const userGuess = this.board.userGuess;
      this.board.displayGuess(userGuess);

      if (userGuess === this.number) {
        this.board.justRight();
      } else if (this.guessCount === this.numberOfGuesses) {
        this.board.tooManyGuesses(this.number);
      } else {
        const guessesLeft = this.numberOfGuesses - this.guessCount;
        if(userGuess < this.number) {
          this.board.tooLow(guessesLeft);
        } else if(userGuess > this.number) {
          this.board.tooHigh(guessesLeft);
        }
      }

      this.guessCount++;
      this.board.resetUserGuessField();
    }
    
    reset(){
      this.board.reset();
      this.start();
    }
  }

  new Game(new Board(document), 
    { max_value: 200,
      guesses: 7 }
    );
</script>
</body>
</html>
